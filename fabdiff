import os
import re
import tkinter as tk
from tkinter import filedialog, scrolledtext

DEFAULT_CS_PATTERN = r'GetFabOrientedUseYn\s*\(\s*(.+?)\s*,\s*(.+?)\s*,\s*(.+?)\s*\)'
DEFAULT_JAVA_PATTERN = r'selectFabOrientedUseYn\s*\(\s*(.+?)\s*,\s*(.+?)\s*,\s*(.+?)\s*\)'


def search_files():
    directory = path_entry.get()
    if not directory:
        result_box.insert(tk.END, "âš  ê²½ë¡œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”\n")
        return

    file_ext = ext_entry.get().strip()
    if not file_ext.startswith("."):
        file_ext = "." + file_ext

    result_box.delete("1.0", tk.END)

    cs_pattern = re.compile(DEFAULT_CS_PATTERN)
    java_pattern = re.compile(DEFAULT_JAVA_PATTERN)

    result_list = []
    count = 0

    for root, dirs, files in os.walk(directory):
        for file in files:
            if not file.endswith(file_ext):
                continue

            file_path = os.path.join(root, file)

            try:
                with open(file_path, "r", encoding="utf-8", errors="ignore") as f:
                    text = f.read()
            except:
                continue

            # CS íŒ¨í„´ ê²€ìƒ‰
            for match in cs_pattern.finditer(text):
                a1, a2, a3 = match.groups()
                result_list.append((file_path, a2.strip(), a3.strip()))
                count += 1

            # JAVA íŒ¨í„´ ê²€ìƒ‰
            for match in java_pattern.finditer(text):
                a1, a2, a3 = match.groups()
                result_list.append((file_path, a1.strip(), a2.strip()))
                count += 1

    # ì¶œë ¥
    for idx, (file, v1, v2) in enumerate(result_list, 1):
        result_box.insert(tk.END, f"No.{idx}\n")
        result_box.insert(tk.END, f"íŒŒì¼: {file}\n")
        result_box.insert(tk.END, f"ê°’1: {v1}\n")
        result_box.insert(tk.END, f"ê°’2: {v2}\n")
        result_box.insert(tk.END, "-" * 50 + "\n")

    result_box.insert(tk.END, f"\nğŸ” ì´ {count}ê±´ ì°¾ìŒ\n")


def browse_folder():
    folder = filedialog.askdirectory()
    if folder:
        path_entry.delete(0, tk.END)
        path_entry.insert(0, folder)


# UI ì˜ì—­
root = tk.Tk()
root.title("ì •ê·œí‘œí˜„ì‹ íŒŒì¼ ê²€ìƒ‰ê¸° (CS/JAVA)")

tk.Label(root, text="ê²€ìƒ‰ ê²½ë¡œ").grid(row=0, column=0, sticky="w")
path_entry = tk.Entry(root, width=60)
path_entry.grid(row=0, column=1)
tk.Button(root, text="ì°¾ê¸°", command=browse_folder).grid(row=0, column=2)

tk.Label(root, text="í™•ì¥ì (ì˜ˆ: cs)").grid(row=1, column=0, sticky="w")
ext_entry = tk.Entry(root, width=10)
ext_entry.insert(0, "cs")
ext_entry.grid(row=1, column=1, sticky="w")

tk.Button(root, text="ê²€ìƒ‰ ì‹¤í–‰", command=search_files).grid(row=2, column=1, pady=5)

result_box = scrolledtext.ScrolledText(root, width=80, height=25)
result_box.grid(row=3, column=0, columnspan=3)

root.mainloop()
